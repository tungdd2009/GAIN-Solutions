<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Lesson Architect</title>

<style>
:root {
    --primary: #1a73e8;
    --secondary: #34a853;
    --accent: #fbbc05;
    --bg: #f4f7fb;
    --surface: #ffffff;
    --border: #dde3ea;
    --text: #202124;
    --muted: #5f6368;
    --error: #ea4335;
    --success: #34a853;
}

* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
    background: linear-gradient(180deg, #eef3fc, var(--bg));
    padding: 24px;
    display: flex;
    justify-content: center;
}

.app {
    max-width: 980px;
    width: 100%;
    background: var(--surface);
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    overflow: hidden;
}

/* HEADER */
.app-header {
    padding: 24px 36px;
    background: linear-gradient(135deg, var(--primary), #4285f4);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.brand {
    display: flex;
    gap: 14px;
    align-items: center;
}

.brand img {
    width: 42px;
    height: 42px;
    background: white;
    border-radius: 10px;
    padding: 6px;
}

.brand h1 {
    margin: 0;
    font-size: 24px;
}

.brand p {
    margin: 4px 0 0 0;
    font-size: 14px;
    opacity: 0.9;
}

.lang-toggle select {
    padding: 6px 10px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    cursor: pointer;
}

/* CONTENT */
.content {
    padding: 36px;
}

.section {
    margin-bottom: 36px;
    border-left: 4px solid var(--primary);
    padding-left: 20px;
}

.section.context {
    border-color: var(--secondary);
}

.section h2 {
    margin-top: 0;
}

.row {
    display: flex;
    gap: 20px;
    margin-bottom: 18px;
}

.col { flex: 1; }

label {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 6px;
    display: block;
    color: var(--text);
}

input, select, textarea {
    width: 100%;
    padding: 11px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: #fbfcff;
    font-family: inherit;
    font-size: 14px;
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
}

small { 
    color: var(--muted);
    font-size: 12px;
}

button {
    width: 100%;
    padding: 16px;
    font-size: 16px;
    font-weight: 600;
    background: linear-gradient(135deg, var(--primary), #4285f4);
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: transform 0.2s, opacity 0.2s;
}

button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
}

button:active:not(:disabled) {
    transform: translateY(0);
}

button:disabled {
    background: #c7c7c7;
    cursor: not-allowed;
    opacity: 0.6;
}

#status {
    display: none;
    margin-top: 18px;
    padding: 18px;
    border-radius: 14px;
    background: #f1f8ff;
    border: 1px solid #d2e3fc;
}

#status.error {
    background: #fce8e6;
    border-color: #f5c6cb;
    color: var(--error);
}

#status.success {
    background: #e6f4ea;
    border-color: #c3e6cb;
    color: var(--success);
}

.spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(26, 115, 232, 0.3);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-right: 8px;
    vertical-align: middle;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>
</head>

<body>

<div class="app">

    <!-- HEADER -->
    <div class="app-header">
        <div class="brand">
            <img src="logo.png" alt="Logo" onerror="this.style.display='none'">
            <div>
                <h1 data-i18n="title"></h1>
                <p data-i18n="subtitle"></p>
            </div>
        </div>

        <div class="lang-toggle">
            <select id="langSelect">
                <option value="VN">ðŸ‡»ðŸ‡³ VN</option>
                <option value="EN">ðŸ‡¬ðŸ‡§ EN</option>
            </select>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="content">

        <div class="section">
            <h2 data-i18n="section1"></h2>
            <p data-i18n="section1_desc"></p>

            <div class="row">
                <div class="col">
                    <label data-i18n="topic"></label>
                    <input id="topic" data-i18n-placeholder="topic_ph">
                </div>
                <div class="col">
                    <label data-i18n="grade"></label>
                    <select id="grade">
                        <option>K-5</option>
                        <option>6-8</option>
                        <option selected>9-12</option>
                        <option>University</option>
                    </select>
                </div>
            </div>

            <label>
                <span data-i18n="slides"></span>:
                <strong><span id="slideValue">5</span></strong>
            </label>
            <input type="range" id="slideCount" min="3" max="16" value="5">
            <small data-i18n="slides_hint"></small>
        </div>

        <div class="section context">
            <h2 data-i18n="section2"></h2>
            <p data-i18n="section2_desc"></p>

            <!-- Row 1 -->
            <div class="row">
                <div class="col">
                    <label data-i18n="method"></label>
                    <select id="method">
                        <option value="traditional" data-i18n="method_traditional"></option>
                        <option value="steam" data-i18n="method_steam"></option>
                        <option value="interactive" data-i18n="method_interactive"></option>
                    </select>
                </div>

                <div class="col">
                    <label data-i18n="teacher_age"></label>
                    <input
                        type="number"
                        id="teacherAge"
                        min="20"
                        max="70"
                        value="30"
                        placeholder="30"
                    />
                    <small data-i18n="teacher_age_hint"></small>
                </div>
            </div>

            <!-- Row 2 -->
            <div class="row">
                <div class="col">
                    <label data-i18n="region"></label>
                    <select id="region">
                        <option value="north" data-i18n="region_north"></option>
                        <option value="central" data-i18n="region_central"></option>
                        <option value="south" data-i18n="region_south"></option>
                    </select>
                </div>

                <div class="col">
                    <label data-i18n="area_type"></label>
                    <select id="areaType">
                        <option value="urban" data-i18n="area_urban"></option>
                        <option value="rural" data-i18n="area_rural"></option>
                        <option value="mountain" data-i18n="area_mountain"></option>
                        <option value="coastal" data-i18n="area_coastal"></option>
                    </select>
                </div>
            </div>

            <!-- Row 3 -->
            <div class="row">
                <div class="col">
                    <label data-i18n="student_context"></label>
                    <textarea
                        id="studentContext"
                        rows="3"
                        data-i18n-placeholder="student_context_ph"
                    ></textarea>
                    <small data-i18n="student_context_hint"></small>
                </div>
            </div>
        </div>


        <button id="generate" disabled data-i18n="generate"></button>
        <div id="status"></div>

    </div>
</div>

<script>
/* === TRANSLATIONS === */
const TEXT = {
    VN: {
        title: "AI Lesson Architect",
        subtitle: "Trá»£ lÃ½ AI giÃºp giÃ¡o viÃªn soáº¡n bÃ i nhanh vÃ  hiá»‡u quáº£",
        section1: "1. ThÃ´ng tin bÃ i há»c",
        section1_desc: "Nháº­p thÃ´ng tin chÃ­nh Ä‘á»ƒ AI hiá»ƒu Ä‘Ãºng má»¥c tiÃªu bÃ i giáº£ng.",
        topic: "Chá»§ Ä‘á» bÃ i há»c",
        topic_ph: "VÃ­ dá»¥: Quang há»£p á»Ÿ thá»±c váº­t",
        grade: "Cáº¥p há»c",
        slides: "Sá»‘ lÆ°á»£ng slide",
        slides_hint: "Gá»£i Ã½: 5â€“7 slide cho má»™t tiáº¿t há»c 45 phÃºt",
        section2: "2. Bá»‘i cáº£nh giáº£ng dáº¡y",
        section2_desc: "ThÃ´ng tin bá»• sung giÃºp bÃ i giáº£ng phÃ¹ há»£p hÆ¡n vá»›i lá»›p há»c.",
        method: "PhÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y",
        method_traditional: "Giáº£ng dáº¡y truyá»n thá»‘ng",
        method_steam: "STEAM / Dáº¡y há»c dá»± Ã¡n",
        method_interactive: "TÆ°Æ¡ng tÃ¡c â€“ hoáº¡t Ä‘á»™ng",
        generate: "ðŸš€ Táº¡o bÃ i giáº£ng báº±ng AI",
        status: "Äang táº¡o bÃ i giáº£ng...",
        teacher_age: "Tuá»•i giÃ¡o viÃªn",
        teacher_age_hint: "GiÃºp AI Ä‘iá»u chá»‰nh cÃ¡ch diá»…n Ä‘áº¡t vÃ  vÃ­ dá»¥ phÃ¹ há»£p",
        region: "Khu vá»±c",
        region_north: "Miá»n Báº¯c",
        region_central: "Miá»n Trung",
        region_south: "Miá»n Nam",
        area_type: "Khu vá»±c sinh sá»‘ng",
        area_urban: "ThÃ nh thá»‹",
        area_rural: "NÃ´ng thÃ´n",
        area_mountain: "Miá»n nÃºi",
        area_coastal: "Ven biá»ƒn",
        student_context: "Bá»‘i cáº£nh Ä‘á»i sá»‘ng há»c sinh",
        student_context_ph: "VÃ­ dá»¥: gia Ä‘Ã¬nh lÃ m nÃ´ng, sá»‘ng gáº§n chá»£, khu cÃ´ng nghiá»‡p...",
        student_context_hint: "AI sáº½ dÃ¹ng cÃ¡c vÃ­ dá»¥ quen thuá»™c vá»›i Ä‘á»i sá»‘ng há»c sinh",
        error: "Lá»—i: ",
        success: "âœ… BÃ i giáº£ng Ä‘Ã£ Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng!",
        downloading: "Äang táº£i xuá»‘ng..."
    },
    EN: {
        title: "AI Lesson Architect",
        subtitle: "AI assistant for faster and clearer lesson planning",
        section1: "1. Lesson information",
        section1_desc: "Provide core information so AI understands your teaching goals.",
        topic: "Lesson topic",
        topic_ph: "e.g. Photosynthesis in plants",
        grade: "Grade level",
        slides: "Number of slides",
        slides_hint: "Recommended: 5â€“7 slides for a 45-minute class",
        section2: "2. Teaching context",
        section2_desc: "Optional inputs to better personalize the lesson.",
        method: "Teaching method",
        method_traditional: "Traditional lecture",
        method_steam: "STEAM / Project-based",
        method_interactive: "Interactive learning",
        generate: "ðŸš€ Generate lesson with AI",
        status: "Generating lesson...",
        teacher_age: "Teacher age",
        teacher_age_hint: "Helps AI adjust tone and examples",
        region: "Region",
        region_north: "Northern Vietnam",
        region_central: "Central Vietnam",
        region_south: "Southern Vietnam",
        area_type: "Living area",
        area_urban: "Urban",
        area_rural: "Rural",
        area_mountain: "Mountainous",
        area_coastal: "Coastal",
        student_context: "Student life context",
        student_context_ph: "e.g. farming families, market life, industrial zones...",
        student_context_hint: "AI will use familiar real-life examples",
        error: "Error: ",
        success: "âœ… Lesson generated successfully!",
        downloading: "Downloading..."
    }
};

/* === STATE === */
let currentLang = "VN";

/* === ELEMENTS === */
const slide = document.getElementById("slideCount");
const slideValue = document.getElementById("slideValue");
const topic = document.getElementById("topic");
const btn = document.getElementById("generate");
const status = document.getElementById("status");
const langSelect = document.getElementById("langSelect");

/* === FUNCTIONS === */
function applyLang(lang) {
    currentLang = lang;
    const t = TEXT[lang];

    document.querySelectorAll("[data-i18n]").forEach(el => {
        el.textContent = t[el.dataset.i18n];
    });

    document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
        el.placeholder = t[el.dataset.i18nPlaceholder];
    });
}

function showStatus(message, type = 'info') {
    status.style.display = "block";
    status.className = type;
    
    if (type === 'loading') {
        status.innerHTML = `<span class="spinner"></span>${message}`;
        status.className = '';
    } else {
        status.textContent = message;
    }
}

function hideStatus() {
    status.style.display = "none";
}

function downloadPPTX(base64Data, filename) {
    const binary = atob(base64Data);
    const array = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++) {
        array[i] = binary.charCodeAt(i);
    }
    const blob = new Blob([array], { 
        type: 'application/vnd.openxmlformats-officedocument.presentationml.presentation' 
    });
    
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

/* === EVENTS === */
slide.oninput = () => slideValue.textContent = slide.value;
topic.oninput = () => btn.disabled = !topic.value.trim();

langSelect.onchange = () => applyLang(langSelect.value);

btn.onclick = async () => {
    const topicValue = topic.value.trim();
    
    if (!topicValue) {
        showStatus(TEXT[currentLang].error + "Please enter a topic", 'error');
        return;
    }

    btn.disabled = true;
    showStatus(TEXT[currentLang].status, 'loading');

    try {
        const payload = {
            topic: topicValue,
            grade: document.getElementById("grade").value,
            slideCount: parseInt(slide.value),
            teacherAge: parseInt(document.getElementById("teacherAge").value) || 30,
            region: document.getElementById("region").value,
            areaType: document.getElementById("areaType").value,
            method: document.getElementById("method").value,
            studentContext: document.getElementById("studentContext").value.trim(),
            language: currentLang
        };

        const response = await fetch('/api/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.error || 'Failed to generate lesson');
        }

        if (data.success && data.file) {
            showStatus(TEXT[currentLang].success, 'success');
            
            // Download the file
            const filename = `${topicValue.replace(/[^a-z0-9]/gi, '_')}_lesson.pptx`;
            downloadPPTX(data.file, filename);
            
            setTimeout(() => {
                hideStatus();
                btn.disabled = false;
            }, 3000);
        } else {
            throw new Error('Invalid response from server');
        }

    } catch (error) {
        console.error('Generation error:', error);
        showStatus(TEXT[currentLang].error + error.message, 'error');
        btn.disabled = false;
    }
};

/* === INIT === */
applyLang("VN");
langSelect.value = "VN";
</script>

</body>
</html>